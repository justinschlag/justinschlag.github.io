<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>20 Questions with JustinBot</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    /* Minimal local styles for this page; your main styles.css handles the rest */
    body { max-width: 900px; margin: 24px auto; padding: 0 16px; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
    #chat-box { border: 1px solid #ddd; border-radius: 12px; padding: 16px; height: 420px; overflow-y: auto; background: #fff; }
    #chat-box p { margin: 0 0 10px; line-height: 1.5; }
    #bot-buttons button, #win-buttons button { margin: 0 6px; padding: 10px 14px; border-radius: 10px; border: none; background: #73000a; color: #fff; cursor: pointer; }
    #bot-buttons button:hover, #win-buttons button:hover { filter: brightness(0.95); transform: translateY(-1px); }
    .hidden { display: none !important; }
    #question-counter { margin: 12px 0; font-weight: 700; }
    #music-toggle button { border: none; padding: 10px 12px; border-radius: 999px; background: #73000a; color: #fff; cursor: pointer; }
    #music-toggle button:hover { filter: brightness(0.95); }
  </style>
</head>
<body>
  <h1>20 Questions with JustinBot</h1>

  <!-- Question Counter -->
  <div id="question-counter" class="hidden">
    Question <span id="q-number">1</span> / 20
  </div>

  <!-- Chat Display -->
  <div id="chat-box"></div>

  <!-- Yes/No Buttons -->
  <div id="bot-buttons" class="hidden" style="text-align:center; margin-top:16px;">
    <button onclick="submitAnswer('yes')">Yes</button>
    <button onclick="submitAnswer('probably')">Probably</button>
    <button onclick="submitAnswer('unknown')">I don't know</button>
    <button onclick="submitAnswer('probably not')">Probably Not</button>
    <button onclick="submitAnswer('no')">No</button>
  </div>

  <!-- Instruction -->
  <p id="guess-instruction" style="text-align:center; margin-top:16px;">
    If JustinBot correctly guesses your word, press <strong>JustinBot Guessed It!</strong>
  </p>

  <!-- Result Buttons -->
  <div id="win-buttons" style="text-align:center; margin-top:16px;">
    <button onclick="botWins()">JustinBot Guessed It!</button>
    <button id="wrong-btn" class="hidden" onclick="botLoses()">No, wrong</button>
  </div>

  <!-- Music Toggle & Audio -->
  <div id="music-toggle" style="position:fixed; bottom:16px; right:16px;">
    <button aria-label="Toggle music">ðŸ”Š</button>
  </div>
  <audio id="bg-music" loop>
    <source src="audio/gameboy-theme.mp3" type="audio/mpeg"/>
  </audio>
  <audio id="sfx-blip"    src="audio/blip.mp3"></audio>
  <audio id="sfx-success" src="audio/success.mp3"></audio>
  <audio id="sfx-lose"    src="audio/lose.mp3"></audio>

<script>
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Helpers & Audio (autoplay-safe)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const $ = id => document.getElementById(id);
  const music      = $("bg-music");
  const blipSFX    = $("sfx-blip");
  const successSFX = $("sfx-success");
  const loseSFX    = $("sfx-lose");

  let userInteracted = false;

  // Unlock audio on first pointer/tap/click (best cross-device)
  document.addEventListener("pointerdown", () => {
    userInteracted = true;
    const p = music.play();
    if (p && typeof p.catch === "function") p.catch(()=>{ /* ignore blocked autoplay */ });
  }, { once: true });

  // Safe play (only after user interaction)
  function safePlay(audioEl) {
    if (!userInteracted) return;
    try {
      audioEl.pause();
      audioEl.currentTime = 0;
      const p = audioEl.play();
      if (p && typeof p.catch === "function") p.catch(()=>{});
    } catch {}
  }

  function toggleMusic(){
    const btn = $("music-toggle").querySelector("button");
    if (music.paused){
      safePlay(music);
      btn.textContent = "ðŸ”Š";
    } else {
      music.pause();
      btn.textContent = "ðŸ”‡";
    }
  }
  $("music-toggle").addEventListener("click", toggleMusic);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Expanded Decision Tree
  // Structure: node = { question: "...", yes: {...}, no: {...} } or { guess: "..." }
  // Keep questions short & binary; breadth-first across domains for coverage.
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const tree = {
    question: "Is it a living thing?",
    yes: {
      question: "Is it a human?",
      yes: {
        question: "Is this a real person (not fictional)?",
        yes: {
          question: "Are they alive today?",
          yes: {
            question: "Are they widely famous?",
            yes: {
              question: "Are they known for entertainment or sports?",
              yes: {
                question: "Entertainment?",
                yes: {
                  question: "Music?",
                  yes: { guess: "Taylor Swift" },
                  no: {
                    question: "Film/TV?",
                    yes: { guess: "Dwayne Johnson" },
                    no: { guess: "MrBeast" }
                  }
                },
                no: {
                  question: "Team sport?",
                  yes: { guess: "LeBron James" },
                  no: { guess: "Serena Williams" }
                }
              },
              no: {
                question: "Science/Tech?",
                yes: { guess: "Elon Musk" },
                no: {
                  question: "Politics/Leadership?",
                  yes: { guess: "Barack Obama" },
                  no: { guess: "Warren Buffett" }
                }
              }
            },
            no: {
              question: "Do you know them personally?",
              yes: { guess: "A friend or family member" },
              no:  { guess: "A local public figure" }
            }
          },
          no: {
            question: "Primarily known for arts/literature?",
            yes: { guess: "Leonardo da Vinci" },
            no: {
              question: "Science/innovation?",
              yes: { guess: "Albert Einstein" },
              no:  { guess: "Queen Elizabeth II" }
            }
          }
        },
        no: {
          question: "From a movie or TV series?",
          yes: {
            question: "Movie?",
            yes: { guess: "James Bond" },
            no:  { guess: "Walter White" }
          },
          no: {
            question: "From a book or game?",
            yes: {
              question: "Book?",
              yes: { guess: "Harry Potter" },
              no:  { guess: "Mario" }
            },
            no: { guess: "Superhero (e.g., Spider-Man)" }
          }
        }
      },
      no: {
        question: "Is it an animal?",
        yes: {
          question: "Is it a mammal?",
          yes: {
            question: "Domesticated?",
            yes: {
              question: "Common house pet?",
              yes: {
                question: "Does it meow?",
                yes: { guess: "Cat" },
                no:  { guess: "Dog" }
              },
              no: { guess: "Horse" }
            },
            no: {
              question: "A large wild animal?",
              yes: { guess: "Elephant" },
              no:  { guess: "Dolphin" }
            }
          },
          no: {
            question: "Bird or reptile/amphibian?",
            yes: {
              question: "Bird?",
              yes: {
                question: "Can it fly?",
                yes: { guess: "Eagle" },
                no:  { guess: "Penguin" }
              },
              no: {
                question: "Reptile?",
                yes: { guess: "Snake" },
                no:  { guess: "Frog" }
              }
            },
            no: {
              question: "Fish or insect?",
              yes: { guess: "Goldfish" },
              no:  { guess: "Butterfly" }
            }
          }
        },
        no: {
          question: "Plant, fungus, or coral?",
          yes: {
            question: "Plant?",
            yes: {
              question: "Tree?",
              yes: { guess: "Oak Tree" },
              no:  { guess: "Rose" }
            },
            no: {
              question: "Fungus?",
              yes: { guess: "Mushroom" },
              no:  { guess: "Coral" }
            }
          },
          no: { guess: "Bacteria or microscopic life" }
        }
      }
    },
    no: {
      question: "Is it man-made?",
      yes: {
        question: "Is it electronic?",
        yes: {
          question: "Is it primarily for communication or computing?",
          yes: {
            question: "Portable?",
            yes: { guess: "Smartphone" },
            no:  { guess: "Desktop computer" }
          },
          no: {
            question: "For entertainment?",
            yes: {
              question: "Audio-focused?",
              yes: { guess: "Headphones" },
              no:  { guess: "Television" }
            },
            no: {
              question: "A camera or gaming device?",
              yes: { guess: "Camera" },
              no:  { guess: "Game Controller" }
            }
          }
        },
        no: {
          question: "Is it mechanical or a tool?",
          yes: {
            question: "Is it a vehicle?",
            yes: {
              question: "Primarily on land?",
              yes: {
                question: "Personal transport?",
                yes: { guess: "Car" },
                no:  { guess: "Bus" }
              },
              no: {
                question: "Water or air?",
                yes: { guess: "Boat" },
                no:  { guess: "Airplane" }
              }
            },
            no: {
              question: "Hand tool or appliance?",
              yes: { guess: "Hammer" },
              no:  { guess: "Drill" }
            }
          },
          no: {
            question: "Is it furniture or a container?",
            yes: {
              question: "Furniture?",
              yes: {
                question: "Seating?",
                yes: { guess: "Chair" },
                no:  { guess: "Table" }
              },
              no: {
                question: "For food/drink?",
                yes: {
                  question: "Drink container?",
                  yes: { guess: "Water Bottle" },
                  no:  { guess: "Bowl" }
                },
                no: { guess: "Backpack" }
              }
            },
            no: {
              question: "Is it clothing or accessory?",
              yes: { guess: "Shirt" },
              no:  { guess: "Watch" }
            }
          }
        }
      },
      no: {
        question: "Is it a natural non-living thing?",
        yes: {
          question: "Element/mineral vs. phenomenon/place?",
          yes: {
            question: "Element or mineral?",
            yes: {
              question: "Element?",
              yes: { guess: "Oxygen" },
              no:  { guess: "Gold" }
            },
            no: {
              question: "Phenomenon vs. geographic feature?",
              yes: { guess: "Lightning" },
              no:  { guess: "Mountain" }
            }
          },
          no: {
            question: "Astronomical object?",
            yes: { guess: "The Sun" },
            no:  { guess: "Rainbow" }
          }
        },
        no: {
          question: "Is it an abstract concept?",
          yes: {
            question: "Emotion or idea?",
            yes: { guess: "Love" },
            no:  {
              question: "Time/Math vs. Principle?",
              yes: { guess: "Time" },
              no:  { guess: "Justice" }
            }
          },
          no: {
            question: "A game or sport?",
            yes: {
              question: "Team sport?",
              yes: { guess: "Soccer" },
              no:  { guess: "Tennis" }
            },
            no: {
              question: "Food or beverage?",
              yes: {
                question: "Beverage?",
                yes: { guess: "Coffee" },
                no:  { guess: "Pizza" }
              },
              no: {
                question: "Place or building?",
                yes: {
                  question: "Natural place?",
                  yes: { guess: "Beach" },
                  no:  { guess: "School" }
                },
                no: { guess: "Board Game (e.g., Chess)" }
              }
            }
          }
        }
      }
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // STATE & CONFIG
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const GENERAL_END  = 17; // ask up to this many general/dynamic questions
  const SPECIFIC_END = 19;
  const FINAL_Q      = 20;

  let qNum         = 1;
  let history      = [];
  let currentNode  = tree;
  let pendingGuess = false;
  let currentQ     = tree.question;
  let askedSet     = new Set([currentQ]);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // UI helpers
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateCounter(){
    $("q-number").textContent = qNum;
    $("question-counter").classList.remove("hidden");
  }
  function addEntry(who, txt){
    const p = document.createElement("p");
    p.innerHTML = `<strong>${who}:</strong> ${txt}`;
    $("chat-box").appendChild(p);
    $("chat-box").scrollTop = $("chat-box").scrollHeight;
  }
  function mapAnswer(ans){
    const a = ans.toLowerCase();
    if (a.startsWith("yes") || a === "probably") return "yes";
    if (a.startsWith("no")  || a === "probably not") return "no";
    return "unknown";
  }
  function getTraitLists(){
    const yes = history.filter(h=>h.a.startsWith("y")).map(h=>h.q).join("; ")||"none";
    const no  = history.filter(h=>h.a.startsWith("n")).map(h=>h.q).join("; ")||"none";
    return {yes,no};
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Dynamic LLM fallbacks (your existing endpoint)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function askLLMQuestion(){
    const {yes,no} = getTraitLists();
    const prompt =
      `The thing is: ${yes}.\n`+
      `The thing is NOT: ${no}.\n`+
      `Ask ONE new yes/no question to narrow it down; avoid repeats. Respond with only the question.\n\n`+
      history.map(h=>`Q: ${h.q}\nA: ${h.a}`).join("\n");
    const res = await fetch("https://justin-bot-ujmo.onrender.com/ask", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({question:prompt})
    }).then(r=>r.json());
    let q = (res.answer || "").trim();
    if(!q) q = "Is it bigger than a car?"; // fallback
    if(askedSet.has(q)) return askLLMQuestion();
    askedSet.add(q);
    currentNode = null;
    currentQ    = q;
    addEntry("Q"+qNum, q);
    safePlay(blipSFX);
  }

  async function askLLMGuess(final=false){
    const {yes,no} = getTraitLists();
    const instr = final
      ? `Final guess: [item]. Respond with only "Final guess: [item]".`
      : `Respond with exactly: "Is it [item]?" (one guess).`;
    const prompt =
      `The thing is: ${yes}.\n`+
      `The thing is NOT: ${no}.\n`+ instr + `\n\n`+
      history.map(h=>`Q: ${h.q}\nA: ${h.a}`).join("\n");
    const res = await fetch("https://justin-bot-ujmo.onrender.com/ask", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({question:prompt})
    }).then(r=>r.json());
    let g = (res.answer || "").trim();
    if(!g) g = "Is it a laptop?"; // fallback
    if(askedSet.has(g)) return askLLMGuess(final);
    askedSet.add(g);
    currentNode  = null;
    currentQ     = g;
    pendingGuess = !final;
    addEntry("Q"+qNum, g);
    safePlay(blipSFX);
    if(final) safePlay(loseSFX);
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Game flow
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startGame(){
    $("chat-box").innerHTML = "";
    $("bot-buttons").classList.remove("hidden");
    $("wrong-btn").classList.add("hidden");
    $("question-counter").classList.remove("hidden");

    qNum = 1;
    history = [];
    currentNode = tree;
    pendingGuess = false;
    currentQ = tree.question;
    askedSet = new Set([currentQ]);

    addEntry("JustinBot","I'm ready! Think of somethingâ€¦ and answer honestly. ðŸ˜Ž");
    addEntry("Q1", currentQ);
    safePlay(blipSFX);
    updateCounter();
  }
  window.onload = startGame;

  function botWins(){
    $("bot-buttons").classList.add("hidden");
    addEntry("JustinBot","Haha! I win again! ðŸ˜Ž");
    safePlay(successSFX);
  }
  function botLoses(){
    $("bot-buttons").classList.add("hidden");
    addEntry("JustinBot","Dang, you got me. ðŸ˜… Thanks for playing!");
    safePlay(loseSFX);
  }

  async function submitAnswer(ans){
    addEntry("You", ans);
    const a = ans.toLowerCase();
    history.push({q:currentQ, a});

    // Only win when it was explicitly posed as a guess
    if (pendingGuess && a.startsWith("y")) {
      return botWins();
    }
    pendingGuess = false;

    // â”€â”€ Static tree navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (currentNode && currentNode.question) {
      const branch = mapAnswer(a);
      const next   = currentNode[branch] || currentNode[branch === "unknown" ? "yes" : "no"] || null;

      if (next && next.guess) {
        qNum++; updateCounter();
        currentQ     = `Is it ${next.guess}?`;
        pendingGuess = true;
        currentNode  = null;
        askedSet.add(currentQ);
        addEntry("Q"+qNum, currentQ);
        safePlay(blipSFX);
        return;
      }
      if (next && next.question) {
        currentNode = next;
        qNum++; updateCounter();
        currentQ = next.question;
        askedSet.add(currentQ);
        addEntry("Q"+qNum, currentQ);
        safePlay(blipSFX);
        return;
      }

      // Fell off a leaf: make a best guess dynamically
      currentNode   = null;
      pendingGuess  = true;
      qNum++; updateCounter();
      return askLLMGuess(false);
    }

    // â”€â”€ Dynamic flow: a few LLM questions, then guesses â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (qNum < GENERAL_END) {
      qNum++; updateCounter();
      return askLLMQuestion();
    }
    if (qNum === GENERAL_END) {
      qNum++; updateCounter();
      return askLLMGuess(false);
    }
    if (qNum === GENERAL_END + 1) {
      qNum++; updateCounter();
      return askLLMGuess(false);
    }
    if (qNum === GENERAL_END + 2) {
      qNum++; updateCounter();
      $("bot-buttons").classList.add("hidden");
      $("wrong-btn").classList.remove("hidden");
      return askLLMGuess(true);
    }
  }
</script>
</body>
</html>
