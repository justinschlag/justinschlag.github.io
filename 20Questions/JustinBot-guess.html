<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>20 Questions with JustinBot</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>20 Questions with JustinBot</h1>

  <div id="question-counter" class="hidden">
    Question <span id="q-number">1</span> / 20
  </div>

  <div id="chat-box"></div>

  <div id="bot-buttons" class="hidden">
    <button onclick="submitAnswer('yes')">Yes</button>
    <button onclick="submitAnswer('probably')">Probably</button>
    <button onclick="submitAnswer('probably not')">Probably Not</button>
    <button onclick="submitAnswer('no')">No</button>
    <button onclick="submitAnswer('unknown')">I don't know</button>
  </div>

<div id="win-buttons" class="hidden" style="text-align:center; margin-top: 16px;">
  <button onclick="botWins()">JustinBot Guessed It!</button>
  <button id="wrong-btn" onclick="botLoses()" class="hidden">No, wrong</button>
</div>


  <div id="back-home">
    <a href="index.html" class="nav-link">‚Üê Back to Home</a>
  </div>

  <div id="music-toggle">
    <button onclick="toggleMusic()">üîä</button>
  </div>

  <audio id="bg-music" loop>
    <source src="audio/gameboy-theme.mp3" type="audio/mpeg" />
  </audio>
  <audio id="sfx-click" src="audio/click.mp3"></audio>
  <audio id="sfx-blip" src="audio/blip.mp3"></audio>
  <audio id="sfx-success" src="audio/success.mp3"></audio>
  <audio id="sfx-lose" src="audio/lose.mp3"></audio>

  <script>
    const $ = id => document.getElementById(id);
    const music = $("bg-music");
    const clickSFX = $("sfx-click");
    const blipSFX = $("sfx-blip");
    const successSFX = $("sfx-success");
    const loseSFX = $("sfx-lose");

    let qNum = 1;
    let history = [];
    let finalGuesses = new Set();
    let currentNode = null;
    let currentQuestion = null;
    let musicStarted = false;

    document.body.addEventListener("click", () => {
      if (!musicStarted) {
        music.play();
        musicStarted = true;
      }
    });

    const play = sfx => { sfx?.pause(); sfx.currentTime = 0; sfx?.play(); };

    function toggleMusic() {
      const btn = $("music-toggle").querySelector("button");
      if (music.paused) {
        music.play();
        btn.textContent = "üîä";
      } else {
        music.pause();
        btn.textContent = "üîá";
      }
    }

    function updateCounter() {
      $("q-number").textContent = qNum;
      $("question-counter").classList.remove("hidden");
    }

    function addEntry(who, text) {
      const p = document.createElement('p');
      p.innerHTML = `<strong>${who}:</strong> ${text}`;
      $("chat-box").appendChild(p);
      $("chat-box").scrollTop = $("chat-box").scrollHeight;
    }

   function startGame() {
  $("chat-box").innerHTML = '';
  $("bot-buttons").classList.remove("hidden");

  // Keep the win-buttons container always visible
  $("win-buttons").classList.remove("hidden");  // ‚úÖ Keep this visible always
  $("wrong-btn").classList.add("hidden");       // ‚ùå Only hide this until Q21

  $("question-counter").classList.remove("hidden");

  qNum = 1;
  history = [];
  finalGuesses.clear();

  currentNode = phase1Tree;
  currentQuestion = currentNode.question;

  addEntry("JustinBot", "I'm ready! Think of something... and answer my questions with honesty. üòé");
  askCurrent();
  updateCounter();
}




    function askCurrent() {
      addEntry("Q" + qNum, currentQuestion);
      play(blipSFX);
    }

function submitAnswer(ans) {
  addEntry("You", ans);
  history.push({ q: currentQuestion, a: ans });

  // advance to next question number
  qNum++;
  updateCounter();

  // 1) Q1‚ÄìQ16: general narrowing questions
  if (qNum <= 16) {
    askLLMQuestion();
    return;
  }

  // 2) Q17‚ÄìQ19: more specific narrowing questions
  if (qNum <= 19) {
    askLLMQuestion();  // same function, but will detect qNum>=17
    return;
  }

  // 3) Q20: final guess
  if (qNum === 20) {
    // hide Yes/No buttons, show only result buttons
    $("bot-buttons").classList.add("hidden");
    $("win-buttons").classList.remove("hidden");
    $("wrong-btn").style.display = "inline-block";

    askFinalGuess();   // only here!
    play(loseSFX);
    return;
  }

  // any qNum > 20 => do nothing
}


    function handlePhase1(ans) {
      const branch = mapAnswer(ans);
      currentNode = currentNode?.[branch];
      if (currentNode?.question) {
        currentQuestion = currentNode.question;
        askCurrent();
      } else {
        askLLMQuestion();
      }
    }

    function buildContextLists() {
      const isList = [];
      const isNotList = [];
      for (const entry of history) {
        const clean = entry.q.replace(/^Is it\\s*/i, '').replace(/\\?$/, '').trim();
        if (entry.a === 'yes' || entry.a === 'probably') isList.push(clean);
        if (entry.a === 'no' || entry.a === 'probably not') isNotList.push(clean);
      }
      return { isList, isNotList };
    }

    function askLLMQuestion() {
      const { isList, isNotList } = buildContextLists();

      const prompt = `You are JustinBot playing 20 Questions.\\nMake a new question to narrow it down, not a guess.\\n\\nThe thing IS:\\n${isList.map(i => '- ' + i).join('\\n') || '- [none]'}\\n\\nThe thing IS NOT:\\n${isNotList.map(i => '- ' + i).join('\\n') || '- [none]'}\\n\\nAsk a useful, general yes/no question to narrow the category.\\nRespond only with: \"[your question]\"`;

      fetch("https://justin-bot-ujmo.onrender.com/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: prompt })
      })
      .then(res => res.json())
      .then(data => {
        currentQuestion = sanitize(data.answer);
        askCurrent();
      });
    }

function askFinalGuess() {
  const { isList, isNotList } = buildContextLists();
  const prior = [...finalGuesses].map(g => `‚Ä¢ ${g}`).join("\n");

  const prompt = `You are JustinBot playing 20 Questions.
Make a final guess based ONLY on what the user said "yes" to.
The thing IS:\n${isList.map(i => '- ' + i).join('\n') || '- [none]'}
The thing IS NOT:\n${isNotList.map(i => '- ' + i).join('\n') || '- [none]'}
Avoid anything already guessed:\n${prior || '[none]'}
Say only: Final guess: [your guess]`;

  fetch("https://justin-bot-ujmo.onrender.com/ask", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ question: prompt })
  })
  .then(res => res.json())
  .then(data => {
    const guess = sanitize(data.answer);
    if (!finalGuesses.has(guess)) {
      finalGuesses.add(guess);
      currentQuestion = `${guess}`;
      askCurrent();
    }
  });
}




    function botWins() {
      addEntry("JustinBot", "Haha! I win again! üòé");
      play(successSFX);
    }

    function botLoses() {
      addEntry("JustinBot", "Dang, you got me this time. üòÖ Thanks for playing!");
      play(loseSFX);
    }

    function mapAnswer(ans) {
      if (ans === "yes" || ans === "probably") return "yes";
      if (ans === "no" || ans === "probably not") return "no";
      return Math.random() > 0.5 ? "yes" : "no";
    }

    function sanitize(text) {
      return text.replace(/^Q\\d+[:.\\-]?\\s*/i, '').replace(/^JustinBot[:\\s-]*/i, '').trim();
    }

   
  // BEGIN: 20 Questions Ultra-Expanded Tree with Specific Common Objects
const phase1Tree = {
  question: "Is it a living thing?",
  yes: {
    question: "Is it a human?",
    yes: {
      question: "Is it real or fictional?",
      yes: {
        question: "Is the person currently alive?",
        yes: {
          question: "Are they a public figure?",
          yes: {
            question: "Are they known globally?",
            yes: {
              question: "Are they known for science, politics, or entertainment?",
              yes: {
                question: "Are they a scientist, entrepreneur, or innovator?",
                yes: {
                  guess: "Elon Musk"
                },
                no: {
                  question: "Are they a musician or pop culture icon?",
                  yes: {
                    guess: "Taylor Swift"
                  },
                  no: {
                    question: "Are they a world leader or president?",
                    yes: {
                      guess: "Barack Obama"
                    }
                  }
                }
              },
              no: {
                question: "Are they a sports figure or athlete?",
                yes: {
                  guess: "Michael Jordan"
                }
              }
            },
            no: {
              question: "Are they known in America during the mid-1900s?",
              yes: {
                guess: "Marilyn Monroe"
              }
            }
          },
          no: {
            question: "Are they someone you know personally or indirectly?"
          }
        },
        no: {
          question: "Did they contribute to science or history in the 20th century?",
          yes: {
            guess: "Albert Einstein"
          }
        }
      },
      no: {
        question: "Are they a fictional character?",
        yes: {
          question: "Are they from books or film?",
          yes: {
            guess: "Harry Potter"
          },
          no: {
            question: "Are they from mythology or fantasy?",
            yes: {
              question: "Do they wield a weapon or magical object?",
              yes: {
                question: "Is it a lightsaber, wand, or hammer?",
                yes: {
                  question: "Does it come from Star Wars, Harry Potter, or Norse myth?",
                  yes: {
                    guess: "Lightsaber"
                  },
                  no: {
                    guess: "Magic wand"
                  }
                },
                no: {
                  question: "Is it a symbolic or cursed item?",
                  yes: {
                    guess: "The One Ring"
                  },
                  no: {
                    guess: "Excalibur"
                  }
                }
              },
              no: {
                question: "Are they ethereal, ghostly, or invisible?",
                yes: {
                  guess: "A ghost"
                }
              }
            }
          }
        }
      }
    },
    no: {
      question: "Is it an animal?",
      yes: {
        question: "Is it a domesticated pet or wild animal?",
        yes: {
          question: "Is it commonly found in homes?",
          yes: {
            question: "Does it meow or bark?",
            yes: {
              guess: "Cat"
            },
            no: {
              guess: "Dog"
            }
          },
          no: {
            question: "Is it used for farming or riding?",
            yes: {
              guess: "Horse"
            }
          }
        },
        no: {
          question: "Is it found in the wild or zoos?",
          yes: {
            question: "Is it large and iconic?",
            yes: {
              question: "Is it known for its trunk, tusks, or size?",
              yes: {
                guess: "Elephant"
              },
              no: {
                question: "Does it live in cold or aquatic environments?",
                yes: {
                  guess: "Penguin"
                },
                no: {
                  question: "Does it swim and use sonar?",
                  yes: {
                    guess: "Dolphin"
                  },
                  no: {
                    question: "Is it known for its roar or mane?",
                    yes: {
                      guess: "Lion"
                    }
                  }
                }
              }
            },
            no: {
              question: "Is it a reptile or bird of prey?",
              yes: {
                question: "Does it slither or fly with sharp eyesight?",
                yes: {
                  guess: "Snake"
                },
                no: {
                  guess: "Eagle"
                }
              },
              no: {
                guess: "Kangaroo"
              }
            }
          }
        }
      },
      no: {
        question: "Is it man-made?",
        yes: {
          question: "Is it electronic or mechanical?",
          yes: {
            question: "Is it used for communication, entertainment, or household tasks?",
            yes: {
              question: "Is it handheld or wearable?",
              yes: {
                question: "Is it used to talk, listen, or compute?",
                yes: {
                  guess: "Smartphone"
                },
                no: {
                  question: "Is it worn in the ears?",
                  yes: {
                    guess: "AirPods"
                  }
                }
              },
              no: {
                question: "Is it a laptop, TV, or game controller?",
                yes: {
                  question: "Is it portable and used for work or play?",
                  yes: {
                    guess: "Laptop"
                  },
                  no: {
                    question: "Is it part of a gaming setup?",
                    yes: {
                      guess: "Game controller"
                    },
                    no: {
                      guess: "Television"
                    }
                  }
                }
              }
            },
            no: {
              question: "Is it used in the kitchen or household?",
              yes: {
                question: "Does it heat, blend, or wash?",
                yes: {
                  question: "Is it a microwave, blender, or washing machine?",
                  yes: {
                    guess: "Microwave"
                  },
                  no: {
                    guess: "Washing machine"
                  }
                },
                no: {
                  guess: "Refrigerator"
                }
              }
            }
          },
          no: {
            question: "Is it a tool or instrument?",
            yes: {
              question: "Is it a hammer, screwdriver, or wrench?",
              yes: {
                guess: "Hammer"
              },
              no: {
                question: "Is it scissors, ruler, or paintbrush?",
                yes: {
                  guess: "Scissors"
                },
                no: {
                  guess: "Paintbrush"
                }
              }
            },
            no: {
              question: "Is it a flashlight or compass?",
              yes: {
                guess: "Flashlight"
              },
              no: {
                guess: "Compass"
              }
            }
          }
        },
        no: {
          question: "Is it furniture, decor, or container?",
          yes: {
            question: "Is it a chair, sofa, or bed?",
            yes: {
              guess: "Chair"
            },
            no: {
              question: "Is it a mirror, clock, or light?",
              yes: {
                guess: "Clock"
              },
              no: {
                guess: "Candle"
              }
            }
          },
          no: {
            question: "Is it a box, backpack, or suitcase?",
            yes: {
              guess: "Backpack"
            },
            no: {
              question: "Is it a cup, bottle, or trash can?",
              yes: {
                guess: "Water bottle"
              },
              no: {
                guess: "Trash can"
              }
            }
          }
        }
      },
      no: {
        question: "Is it a natural object, element, or concept?",
        yes: {
          question: "Is it physical like rock, water, or sand?",
          yes: {
            guess: "Water"
          },
          no: {
            question: "Is it a tree, cloud, or fire?",
            yes: {
              guess: "Fire"
            },
            no: {
              question: "Is it mountain, ice, or gold?",
              yes: {
                guess: "Gold"
              }
            }
          }
        },
        no: {
          question: "Is it abstract like time, love, or fear?",
          yes: {
            guess: "Time"
          },
          no: {
            question: "Is it related to the mind or spirit, like dream or justice?",
            yes: {
              guess: "Justice"
            }
          }
        }
      }
    }
  }
};
// END: 20 Questions Ultra-Expanded Tree with Specific Common Objects


  </script>

  <script>
    window.onload = () => startGame();
  </script>
</body>
</html>
